<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>离心泵工程师工具箱</title>
    <link rel="stylesheet" href="styles.css">
    <!-- 先加载QRCode库 -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="payment/payment-config.js"></script>
    <script src="payment/payment-functions.js"></script>
    <script src="payment/timer-manager.js"></script>
    <!-- 添加 marked.js 用于处理markdown -->
    <script src="vibration-analysis.html"></script>
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-category">
                <h3>计算工具</h3>
                <ul>
                    <li><a href="optimization.html">优化计算</a></li>
                    <li><a href="balance.html">叶轮平衡</a></li>
                    <li><a href="unit-converter.html">单位换算</a></li>
                    <li><a href="pipe-loss.html">管道损失</a></li>
                    <li><a href="stress-relief.html">应力消除</a></li>
                    <li><a href="https://lobe-two-lime.vercel.app/chat?session=095fd79a-f639-45e0-b67c-0f3fb8e903f7&topic=SwxpjZXJ">振动分析</a></li>
                </ul>
            </div>
            
            <div class="sidebar-category">
                <h3>技术资料</h3>
                <ul>
                    <li><a href="manual.html">技术手册</a></li>
                    <li><a href="cases.html">应用案例</a></li>
                </ul>
            </div>

            <div class="sidebar-category">
                <h3>用户中心</h3>
                <ul>
                    <li><a href="user-management.html" style="display: flex; align-items: center; gap: 5px;">
                        长期用户管理
                    </a></li>
                </ul>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <h1 class="page-title">工具箱主页</h1>
            <!-- 搜索和激活按钮区域 -->
            <div style="
                display: flex;
                gap: 10px;
                align-items: center;
                margin-bottom: 15px;
            ">
                <input type="search" class="search-input" placeholder="搜索工具..." style="flex: 1;">
                
                <!-- 激活按钮 -->
                <button onclick="debugUnlock()" style="
                    background: #007bff;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 4px;
                    color: white;
                    cursor: pointer;
                    font-size: 13px;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    transition: background 0.3s;
                ">
                    <svg viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                        <path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8 S16.4,20,12,20z M16,7l-4,4l-4-4H16z M16,11l-4,4l-4-4H16z" fill="#00ffff"/>
                    </svg>
                    激活
                </button>
            </div>

            <!-- 付费功能区域 -->
            <div class="premium-features" style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 15px;
                margin: 10px 0; 
                padding: 8px 15px; 
                background: #f8f9fa; 
                border-radius: 8px;
            ">
                <p style="color: #666; margin: 0; font-size: 13px;">优化计算、振动分析和应力消除需要付费使用</p>
                <button onclick="PaymentFunctions.showPayment()" class="premium-button" style="
                    background: var(--primary-color);
                    color: white;
                    border: none;
                    padding: 6px 15px;
                    border-radius: 4px;
                    font-size: 13px;
                    cursor: pointer;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    margin: 0;
                    white-space: nowrap;
                ">
                    立即使用
                </button>
                <p style="font-size: 12px; color: #999; margin: 0; white-space: nowrap;">¥0.99/小时</p>
            </div>

            <h2 class="section-title">常用工具</h2>
            <div class="tools-grid">
                <a href="optimization.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V7H17V17Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">优化计算</div>
                </a>

                <a href="balance.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">叶轮平衡</div>
                </a>

                <a href="unit-converter.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V7H17V17Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">单位换算</div>
                </a>

                <a href="pipe-loss.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H16L12,22L8,18H4A2,2 0 0,1 2,16V4A2,2 0 0,1 4,2M4,4V16H8.83L12,19.17L15.17,16H20V4H4Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">管道损失</div>
                </a>

                <!-- 添加应力消除工具卡片 -->
                <a href="stress-relief.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">应力消除</div>
                </a>

                <a href="vibration-analysis.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">振动分析</div>
                </a>
            </div>

            <h2 class="section-title">技术资料</h2>
            <div class="tools-grid">
                <a href="manual.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M19,2L14,6.5V17.5L19,13V2M6.5,5C4.55,5 2.45,5.4 1,6.5V21.16C1,21.41 1.25,21.66 1.5,21.66C1.6,21.66 1.65,21.59 1.75,21.59C3.1,20.94 5.05,20.5 6.5,20.5C8.45,20.5 10.55,20.9 12,22C13.35,21.15 15.8,20.5 17.5,20.5C19.15,20.5 20.85,20.81 22.25,21.56C22.35,21.61 22.4,21.59 22.5,21.59C22.75,21.59 23,21.34 23,21.09V6.5C22.4,6.05 21.75,5.75 21,5.5V19C19.9,18.65 18.7,18.5 17.5,18.5C15.8,18.5 13.35,19.15 12,20V6.5C10.55,5.4 8.45,5 6.5,5V5Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">技术手册</div>
                </a>

                <a href="cases.html" class="tool-item">
                    <div class="tool-icon">
                        <svg viewBox="0 0 24 24" fill="#2E7D32">
                            <path d="M4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H16L12,22L8,18H4A2,2 0 0,1 2,16V4A2,2 0 0,1 4,2M4,4V16H8.83L12,19.17L15.17,16H20V4H4Z" fill="#2E7D32"/>
                        </svg>
                    </div>
                    <div class="tool-name">应用案例</div>
                </a>
            </div>
        </div>
    </div>

    <!-- 支付模态窗口 -->
    <div id="paymentModal" class="payment-modal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    ">
        <div class="payment-content" style="
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
            position: relative;
            margin: 20% auto;
        ">
            <h3 style="margin-top: 0;">优化计算&AI 振动分析&应力消除解锁为付费项目</h3>
            <p>使用时长：1小时</p>
            <p>付费金额：<span class="price" style="color: #f60; font-size: 20px; font-weight: bold;">¥0.99</span></p>
            
            <div class="qr-code-container" style="
                margin: 20px 0;
                padding: 20px;
                background: #f5f5f5;
                border-radius: 4px;
                text-align: center;
            ">
                <div id="qrCode"></div>
                <p style="margin-top: 10px; color: #666;">请使用支付宝扫码支付</p>
            </div>
            
            <div id="paymentStatus" class="payment-status" style="text-align: center;"></div>
            
            <button onclick="PaymentFunctions.closePaymentModal()" class="cancel-button" style="
                margin-top: 15px;
                padding: 8px 20px;
                border: none;
                background: #f5f5f5;
                border-radius: 4px;
                cursor: pointer;
                width: 100%;
            ">取消</button>
        </div>
    </div>

    <script>
        // 侧边栏折叠效果
        const categories = document.querySelectorAll('.sidebar-category');
        categories.forEach(category => {
            const title = category.querySelector('h3');
            title.addEventListener('click', () => {
                category.classList.toggle('active');
            });
        });

        // 添加调试用的点击处理函数
        function handlePaymentClick() {
            console.log('Payment button clicked');
            // 添加延迟检查
            setTimeout(() => {
                if (typeof window.showPayment === 'function') {
                    window.showPayment();
                } else {
                    console.error('showPayment function not found');
                    alert('支付功能加载失败，请刷新页面重试');
                }
            }, 100);
        }

        // 添加页面加载完成的检查
        window.addEventListener('load', function() {
            console.log('Page loaded');
            console.log('showPayment function available:', typeof window.showPayment === 'function');
        });

        function checkAndRedirect(page) {
            if (TimerManager.isValid()) {
                // 如果在有效期内，直接跳转
                window.location.href = page;
            } else {
                // 如果不在有效期，显示支付窗口
                PaymentFunctions.showPayment();
            }
            return false;
        }

        // 添加调试功能脚本
        function debugUnlock() {
            // 先显示支付窗口
            PaymentFunctions.showPayment();
            
            // 3秒后自动关闭并解锁
            setTimeout(() => {
                // 关闭支付窗口
                PaymentFunctions.closePaymentModal();
                
                // 启动计时器
                TimerManager.startTimer();
                
                // 显示提示
                alert('调试模式：所有功能已解锁1小时');
                
                // 刷新页面以更新状态
                window.location.reload();
            }, 3000);
        }
    </script>
</body>
</html> 
